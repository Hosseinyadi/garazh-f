# راهنمای تست و راه‌اندازی سیستم

## 📋 پیش‌نیازها

1. **اکانت Supabase**: شما باید در [supabase.com](https://supabase.com) ثبت‌نام کرده باشید
2. **پروژه Supabase**: پروژه خود را ایجاد کرده باشید
3. **کلیدهای API**: URL و API Key پروژه خود را داشته باشید

## 🚀 مراحل راه‌اندازی

### 1. اعمال Migrationها

1. به داشبورد Supabase بروید
2. به بخش **SQL Editor** بروید
3. فایل `supabase/migrations/20250829192153_add_missing_tables.sql` را باز کنید
4. تمام محتویات را کپی کرده و در SQL Editor Paste کنید
5. روی **Run** کلیک کنید

### 2. تنظیم Admin User

1. ابتدا در برنامه ثبت‌نام کنید (یا وارد شوید)
2. به **Authentication > Users** در Supabase بروید
3. User ID خود را کپی کنید
4. به **SQL Editor** بروید و این کد را اجرا کنید:

```sql
INSERT INTO public.user_roles (user_id, role)
VALUES ('YOUR_USER_ID_HERE', 'admin');
```

**نکته**: YOUR_USER_ID_HERE را با User ID واقعی خود جایگزین کنید

### 3. تنظیم داده‌های آزمایشی

فایل `setup-admin.sql` را در SQL Editor اجرا کنید تا داده‌های آزمایشی اضافه شوند.

## 🧪 راهنمای تست

### تست پنل فروشنده (SellerDashboard)

1. وارد شوید و به `/seller` بروید
2. **تب آگهی‌ها (Ads)**:
   - آگهی جدید ایجاد کنید
   - تصاویر آپلود کنید
   - آگهی را ویرایش کنید
   - آگهی را حذف کنید

3. **تب سفارش‌ها (Orders)**:
   - ابتدا باید سفارش‌هایی داشته باشید (در مرحله بعد توضیح داده می‌شود)

4. **تب پیام‌ها (Messages)**:
   - ابتدا باید پیام‌هایی داشته باشید

### تست پنل مدیریت (Admin)

1. وارد شوید و به `/admin` بروید
2. **داشبورد (Dashboard)**:
   - آمار کلی را مشاهده کنید

3. **تایید آگهی‌ها (Moderation)**:
   - آگهی‌های در انتظار تایید را ببینید
   - آگهی‌ها را تایید یا رد کنید

4. **دسته‌بندی‌ها (Categories)**:
   - دسته‌بندی جدید ایجاد کنید
   - دسته‌بندی‌ها را ویرایش کنید
   - دسته‌بندی‌ها را فعال/غیرفعال کنید

### تست سیستم سفارش و پیام

برای تست کامل سیستم، نیاز به کاربر دیگری دارید:

1. **کاربر اول**: آگهی ایجاد کند
2. **کاربر دوم**: برای آن آگهی سفارش دهد یا پیام بفرستد

### تست نوتیفیکیشن‌ها

1. آگهی ایجاد کنید
2. به پنل مدیریت بروید و آگهی را تایید کنید
3. نوتیفیکیشن ایمیل و در-app را چک کنید

## 🔧 عیب‌یابی

### مشکل: نمی‌توانم به پنل مدیریت بروم

**علت**: کاربر admin نیست

**راه‌حل**:
1. مطمئن شوید User ID صحیح را در `user_roles` وارد کرده‌اید
2. این کوئری را اجرا کنید:

```sql
SELECT * FROM public.user_roles WHERE user_id = 'YOUR_USER_ID';
```

### مشکل: جداول وجود ندارند

**علت**: Migration اعمال نشده

**راه‌حل**:
1. فایل migration را دوباره اجرا کنید
2. مطمئن شوید تمام خطاها رفع شده‌اند

### مشکل: تصاویر آپلود نمی‌شوند

**علت**: Storage bucket تنظیم نشده

**راه‌حل**:
1. به **Storage** در Supabase بروید
2. Bucket با نام `images` ایجاد کنید
3. Policy برای آپلود عمومی تنظیم کنید

## 📊 ویژگی‌های قابل تست

### ✅ کامل شده:
- [x] CRUD آگهی‌ها
- [x] آپلود تصاویر
- [x] مدیریت دسته‌بندی‌ها
- [x] تایید/رد آگهی‌ها
- [x] سیستم نوتیفیکیشن
- [x] مدیریت سفارش‌ها
- [x] سیستم پیام‌ها
- [x] ایمیل‌های خودکار

### 🔄 نیاز به تنظیم:
- [ ] اتصال به سرویس ایمیل (اختیاری)
- [ ] تنظیم Storage bucket
- [ ] ایجاد کاربر admin

## 🎯 سناریوی تست کامل

1. **ثبت‌نام و تنظیم Admin**
2. **ایجاد دسته‌بندی‌ها در پنل مدیریت**
3. **ایجاد آگهی در پنل فروشنده**
4. **تایید آگهی در پنل مدیریت**
5. **ایجاد سفارش/پیام برای آگهی**
6. **بررسی نوتیفیکیشن‌ها**
7. **مدیریت سفارش‌ها در پنل فروشنده**

## 📞 پشتیبانی

اگر با مشکل مواجه شدید:

1. Console مرورگر را چک کنید
2. Network tab را بررسی کنید
3. مطمئن شوید Supabase connection درست است
4. فایل‌های log را بررسی کنید

**موفق باشید! 🎉**